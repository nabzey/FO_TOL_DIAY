<!-- Full Page Background -->
<div style="min-height:100vh; background:#fff; display:flex;">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <a class="sidebar-brand" href=" ">
        <span class="brand-name animated-title">Fotoljay</span>
      </a>
    </div>

    <nav class="sidebar-nav">
      <a routerLink="/" class="sidebar-link active">
        <lucide-icon [img]="Home" [size]="20"></lucide-icon>
        <span>Accueil</span>
      </a>
      <a routerLink="/seller-auth" class="sidebar-link">
        <lucide-icon [img]="User" [size]="20"></lucide-icon>
        <span>Espace Vendeur</span>
      </a>
      <a routerLink="/sell" class="sidebar-link">
        <lucide-icon [img]="Plus" [size]="20"></lucide-icon>
        <span>Vendre un produit</span>
      </a>
      <a routerLink="/login" class="sidebar-link">
        <lucide-icon [img]="Shield" [size]="20"></lucide-icon>
        <span>Connexion Admin</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <app-theme-selector #themeSelector></app-theme-selector>
    </div>
  </aside>

  <!-- Mobile Menu Overlay -->
  @if (mobileMenuOpen()) {
  <div class="mobile-menu-overlay" (click)="closeMobileMenu()">
    <div class="mobile-menu" (click)="$event.stopPropagation()">
      <div class="mobile-menu-header">
        <span class="mobile-menu-title">Menu</span>
        <button class="mobile-menu-close" (click)="closeMobileMenu()" aria-label="Fermer">
          <lucide-icon [img]="X" [size]="24"></lucide-icon>
        </button>
      </div>
      <div class="mobile-menu-content">
        <div
          class="mobile-menu-item"
          (click)="openThemeSelector()"
          role="button"
          tabindex="0"
          aria-label="Changer le thème"
          style="cursor: pointer"
        >
          <lucide-icon [img]="Palette" [size]="20"></lucide-icon>
          <span>Changer le thème</span>
        </div>
        <a routerLink="/seller-auth" class="mobile-menu-item" (click)="closeMobileMenu()">
          <lucide-icon [img]="User" [size]="20"></lucide-icon>
          <span>Espace Vendeur</span>
        </a>
        <a routerLink="/sell" class="mobile-menu-item" (click)="closeMobileMenu()">
          <lucide-icon [img]="Plus" [size]="20"></lucide-icon>
          <span>Vendre un produit</span>
        </a>
        <a routerLink="/login" class="mobile-menu-item" (click)="closeMobileMenu()">
          <span>Connexion Admin</span>
        </a>
      </div>
    </div>
  </div>
  }

  <!-- Main Content -->
  <main class="main-content">
    <div class="hero" style="background:#fff;">
      <div class="hero-title" style="color:#e91e63;">FOTOL JAY</div>
      <div class="hero-subtitle" style="color:#e91e63;">Découvrez notre collection unique de photos authentiques</div>
      <div class="hero-actions">
        <a routerLink="/login" class="hero-btn" style="background:#e91e63; color:#fff;">Se connecter</a>
        <a routerLink="/products" class="hero-btn" style="background:#fff; color:#e91e63; border:2px solid #e91e63;">Explorer les produits</a>
      </div>
    </div>

    <div class="container">
    <!-- Barre de recherche -->
    <div class="card mb-4" style="background:#fff; box-shadow:0 2px 12px #e91e6333; border-radius:24px;">
      <form (ngSubmit)="onSearch()" class="search-form" style="display:flex; gap:1rem; align-items:center; justify-content:center; padding:2rem 1rem;">
        <input
          type="text"
          [value]="searchTerm()"
          (input)="searchTerm.set($any($event.target).value)"
          name="search"
          class="form-input"
          style="flex:1; padding:1rem 1.5rem; border-radius:30px; border:1.5px solid #e91e63; font-size:1.1rem; box-shadow:0 2px 8px #e91e6322; outline:none;"
          placeholder="Rechercher un produit..."
        />
        <button type="submit" class="btn btn-primary" style="background:#e91e63; color:#fff; border-radius:30px; padding:1rem 2rem; font-size:1.1rem; font-weight:600; box-shadow:0 2px 8px #e91e6322; border:none;">
          <lucide-icon [img]="Search" [size]="18"></lucide-icon>
          Rechercher
        </button>
      </form>
    </div>

    <!-- Loading -->
    @if (loading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p class="mt-2">Chargement des produits...</p>
    </div>
    }

    <!-- Liste des produits -->
    @else { @if (products().length === 0) {
    <div class="text-center mt-4">
      <p class="empty-message">Aucun produit trouvé</p>
    </div>
    } @else {
    <div class="products-grid">
      @for (product of products(); track product.id) {
      <div class="product-card">
        <img
          [src]="getPrimaryPhoto(product)"
          [alt]="product.title"
          [title]="product.title"
          class="product-image"
          appNoDownload
          (click)="viewProduct(product, $event)"
          (error)="$any($event.target).src = '/placeholder.svg'"
        />
        <div class="product-body">
          @if (product.isVip) {
          <span class="badge badge-vip">
            <lucide-icon [img]="Star" [size]="16"></lucide-icon>
            VIP
          </span>
          }
          <h3 class="product-title">{{ product.title }}</h3>
          <p class="product-description">{{ product.description }}</p>

          <!-- Informations du vendeur -->
          <div class="product-seller">
            <div class="seller-header">
              <lucide-icon [img]="User" [size]="16" class="seller-icon"></lucide-icon>
              <span class="seller-label">Vendeur</span>
            </div>
            <div class="seller-name">
              {{ product.seller.firstName || 'N/A' }} {{ product.seller.lastName || '' }}
            </div>
            <div class="seller-contact">
              @if (product.seller.email) {
              <a
                [href]="'mailto:' + product.seller.email"
                class="contact-link"
                title="Contacter par email"
              >
                <lucide-icon [img]="Mail" [size]="16"></lucide-icon>
                <span class="contact-text">Email</span>
              </a>
              } @if (product.seller.phone) {
              <a
                [href]="'tel:' + product.seller.phone"
                class="contact-link"
                title="Contacter par téléphone"
              >
                <lucide-icon [img]="Phone" [size]="16"></lucide-icon>
                <span class="contact-text">Téléphone</span>
              </a>
              }
            </div>
          </div>

          <div class="product-footer">
            <span class="product-views">
              <lucide-icon [img]="Eye" [size]="16"></lucide-icon>
              {{ product.views }} vues
            </span>
            <button class="btn btn-sm btn-primary" (click)="viewProduct(product, $event)">
              Voir détails
            </button>
          </div>
        </div>
      </div>
      }
    </div>
    } }
  </div>
 </main>

  <!-- Modal Product Details -->
  @if (showModal() && selectedProduct(); as product) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <button class="modal-close-btn" (click)="closeModal()" aria-label="Fermer">
        <lucide-icon [img]="X" [size]="24"></lucide-icon>
      </button>

      <!-- Images Gallery -->
      <div class="modal-gallery">
        @for (photo of product.photos; track photo.id) {
        <img
          [src]="photo.url"
          [alt]="'Photo ' + ($index + 1)"
          [title]="'Photo ' + ($index + 1) + ' de ' + product.title"
          class="modal-gallery-image"
          appNoDownload
          (error)="$any($event.target).src = '/placeholder.svg'"
        />
        }
      </div>

      <!-- Product Info -->
      <div class="modal-content">
        <div class="modal-header-section">
          @if (product.isVip) {
          <span class="badge badge-vip">
            <lucide-icon [img]="Star" [size]="16"></lucide-icon>
            VIP
          </span>
          }
          <h2 class="modal-title">{{ product.title }}</h2>
          <div class="modal-meta">
            <span class="meta-item">
              <lucide-icon [img]="Eye" [size]="16"></lucide-icon>
              {{ product.views }} vues
            </span>
          </div>
        </div>

        <div class="modal-section">
          <h3 class="modal-section-title">Description</h3>
          <p class="modal-description">{{ product.description }}</p>
        </div>

        <div class="modal-section">
          <h3 class="modal-section-title">
            <lucide-icon [img]="User" [size]="20"></lucide-icon>
            Informations du vendeur
          </h3>
          <div class="seller-contact">
            <div class="contact-item">
              <lucide-icon [img]="User" [size]="18" class="contact-icon"></lucide-icon>
              <div>
                <span class="contact-label">Nom du vendeur</span>
                <span class="contact-value"
                  >{{ product.seller.firstName || 'N/A' }} {{ product.seller.lastName || '' }}</span
                >
              </div>
            </div>
            @if (product.seller.email) {
            <a [href]="'mailto:' + product.seller.email" class="contact-item contact-link">
              <lucide-icon [img]="Mail" [size]="18" class="contact-icon"></lucide-icon>
              <div>
                <span class="contact-label">Email</span>
                <span class="contact-value">{{ product.seller.email }}</span>
              </div>
            </a>
            } @if (product.seller.phone) {
            <a [href]="'tel:' + product.seller.phone" class="contact-item contact-link">
              <lucide-icon [img]="Phone" [size]="18" class="contact-icon"></lucide-icon>
              <div>
                <span class="contact-label">Téléphone</span>
                <span class="contact-value">{{ product.seller.phone }}</span>
              </div>
            </a>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
  }
</div>
